@model PagedList.PagedList<DataBase.Product>
@using ShopKA.Models
@using DataBase
@{
    ViewBag.Title = "Product";
    Layout = "~/Views/Shared/_mainLayout.cshtml";
}


<div class="app-content">

    <!--====== Section 1 ======-->
    <div class="u-s-p-y-90">
        <div class="container">
            <div class="row">
                <div class="col-lg-3 col-md-12">
                    <div class="shop-w-master">
                        <h1 class="shop-w-master__heading u-s-m-b-30">
                            <i class="fas fa-filter u-s-m-r-8"></i>

                            <span>LỰA CHỌN</span>
                        </h1>
                        <div class="shop-w-master__sidebar">
                            <div class="u-s-m-b-30">
                                <div class="shop-w shop-w--style">
                                    <div class="shop-w__intro-wrap">
                                        <h1 class="shop-w__h">DANH MỤC</h1>

                                        <span class="fas fa-minus shop-w__toggle" data-target="#s-category" data-toggle="collapse"></span>
                                    </div>
                                    <div class="shop-w__wrap collapse show" id="s-category">
                                        <ul class="shop-w__category-list gl-scroll">
                                            @{var a = DBIO.getallProductT();
                                                }
                                            <li>
                                                <a class="Producer" data_value=-1 >TẤT CẢ SP</a>

                                                <span class="category-list__text u-s-m-l-6">(0)</span>
                                            </li>
                                            @foreach(var item in a) 
                                            { var b = DBIO.getallProducer_ProductT(item.ID);
                                            <li class="has-list">

                                                <a class="ProductTID" data_value=@item.ID>@item.ProducTName</a>

                                                <span class="category-list__text u-s-m-l-6" >(@DBIO.Count_Producer_ProductT(item.ID))</span>

                                                <span class="js-shop-category-span fas fa-plus u-s-m-l-6"></span>
                                                <ul >
                                                    @foreach (var item2 in b) {
                                                <li class="has-list">

                                                    <a class="Producer" data_value=@item2.ID>@item2.ProducerName</a><a >(@DBIO.Count_Product_Producer(item2.ID))</a>


                                                </li>}


                                                </ul>
                                            </li>
                                            }
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            <div class="u-s-m-b-30">
                                <div class="shop-w shop-w--style">
                                    <div class="shop-w__intro-wrap">
                                        <h1 class="shop-w__h">XẾP HẠNG</h1>

                                        <span class="fas fa-minus shop-w__toggle" data-target="#s-rating" data-toggle="collapse"></span>
                                    </div>
                                    <div class="shop-w__wrap collapse show" id="s-rating">
                                        <ul class="shop-w__list gl-scroll">
                                            <li>
                                                <div class="rating__check">

                                                    <input type="radio" name="rate1" value=5>
                                                    <div class="rating__check-star-wrap"><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i></div>
                                                </div>

                                                <span class="shop-w__total-text">(@DBIO.getallProduct().Count(i => DBIO.AVGRatingReview(i.ID) >= 5 & i.Status == true & i.Launch == true))</span>
                                            </li>
                                            <li>
                                                <div class="rating__check">

                                                    <input type="radio" name="rate1" value=4>
                                                    <div class="rating__check-star-wrap">
                                                        <i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="far fa-star"></i>

                                                        <span>& Hơn</span>
                                                    </div>
                                                </div>

                                                <span class="shop-w__total-text">(@DBIO.getallProduct().Count(i => DBIO.AVGRatingReview(i.ID) >= 4 & i.Status == true & i.Launch == true))</span>
                                            </li>
                                            <li>
                                                <div class="rating__check">

                                                    <input type="radio" name="rate1" value=3>
                                                    <div class="rating__check-star-wrap">
                                                        <i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="far fa-star"></i><i class="far fa-star"></i>

                                                        <span>& Hơn</span>
                                                    </div>
                                                </div>

                                                <span class="shop-w__total-text">(@DBIO.getallProduct().Count(i => DBIO.AVGRatingReview(i.ID) >= 3 & i.Status == true & i.Launch == true))</span>
                                            </li>
                                            <li>
                                                <div class="rating__check">

                                                    <input type="radio" name="rate1" value=2>
                                                    <div class="rating__check-star-wrap">
                                                        <i class="fas fa-star"></i><i class="fas fa-star"></i><i class="far fa-star"></i><i class="far fa-star"></i><i class="far fa-star"></i>

                                                        <span>& Hơn</span>
                                                    </div>
                                                </div>

                                                <span class="shop-w__total-text">((@DBIO.getallProduct().Count(i => DBIO.AVGRatingReview(i.ID) >= 2 & i.Status == true & i.Launch == true)))</span>
                                            </li>
                                            <li>
                                                <div class="rating__check">

                                                    <input type="radio" name="rate1" value=1>
                                                    <div class="rating__check-star-wrap">
                                                        <i class="fas fa-star"></i><i class="far fa-star"></i><i class="far fa-star"></i><i class="far fa-star"></i><i class="far fa-star"></i>

                                                        <span>& Hơn</span>
                                                    </div>
                                                </div>

                                                <span class="shop-w__total-text">((@DBIO.getallProduct().Count(i => DBIO.AVGRatingReview(i.ID) >= 1 & i.Status == true & i.Launch == true)))</span>
                                            </li>
                                            <li>
                                                <div class="rating__check">

                                                    <input type="radio" name="rate1" value=0 checked>
                                                    <div class="rating__check-star-wrap">
                                                        <i class="far fa-star"></i><i class="far fa-star"></i><i class="far fa-star"></i><i class="far fa-star"></i><i class="far fa-star"></i>

                                                        <span>& Hơn</span>
                                                    </div>
                                                </div>

                                                <span class="shop-w__total-text">((@DBIO.getallProduct().Count(i => DBIO.AVGRatingReview(i.ID) >= 0 & i.Status == true & i.Launch == true)))</span>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="u-s-m-b-30">
                                <div class="shop-w shop-w--style">
                                    <div class="shop-w__intro-wrap">
                                        <h1 class="shop-w__h">GIÁ</h1>

                                        <span class="fas fa-minus shop-w__toggle" data-target="#s-price" data-toggle="collapse"></span>
                                    </div>
                                    <div class="shop-w__wrap collapse show" id="s-price">
                                        <form class="shop-w__form-p">
                                            <div class="shop-w__form-p-wrap">
                                                <div>

                                                    <label for="price-min"></label>

                                                    <input class="input-text input-text--primary-style" type="number" id="min" placeholder="Min">
                                                </div>
                                                <div>

                                                    <label for="price-max"></label>

                                                    <input class="input-text input-text--primary-style" type="number" id="max" placeholder="Max">
                                                </div>
                                                <div>

                                                    <button type="button" id="price" class="btn btn-primary">OK</button>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                            
                            
                            
                        </div>
                    </div>
                </div>
                <div class="col-lg-9 col-md-12" >
                    <div class="shop-p">
                        <div class="shop-p__toolbar u-s-m-b-30">
                            @if (ViewBag.key != "")
                            {
                            <div class="shop-p__meta-wrap u-s-m-b-60">

                                <span class="shop-p__meta-text-1">TÌM THẤY @ViewBag.result KẾT QUẢ </span>
                                <div class="shop-p__meta-text-2">

                                    <span>TỪ KHÓA:</span>

                                    <a class="gl-tag btn--e-brand-shadow" href="#">@ViewBag.key</a>

                                   
                                </div>
                            </div>}
                            <div class="shop-p__tool-style">
                                <div class="tool-style__group u-s-m-b-8">

                                    <span id="Grid" class="js-shop-grid-target is-active">Lưới</span>

                                    <span id="List" class="js-shop-list-target">Danh Sách</span>
                                </div>
                                <form>
                                    <div class="tool-style__form-wrap">
                                        <div class="u-s-m-b-8">
                                            <select class="select-box select-box--transparent-b-2" id="show">
                                                <option value=9>Hiển thị: 9</option>
                                                <option selected value=12>Hiển thị: 12</option>
                                                <option value=18>Hiển thị: 18</option>
                                                <option value=24>Hiển thị: 24</option>
                                            </select>
                                        </div>
                                        <div class="u-s-m-b-8">
                                            <select class="select-box select-box--transparent-b-2" id="sort">

                                                <option selected value="ID">Sắp xếp: Mới Nhất</option>
                                                <option value="View1">Sắp xếp: Lượt xem </option>
                                                <option value="Sell">Sắp xếp: Bán chạy nhât</option>
                                                <option value="Sale">Sắp xếp: Giảm giá sâu nhất</option>
                                                <option value="Price">Sắp xếp: Giá cao đến thấp </option>
                                                <option value="Price2">Sắp xếp: Giá thấp đến cao </option>

                                            </select>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                        <div id="key" data_value=@ViewBag.key></div>
                        <div class="shop-p__collection" id="ketqua">
                            <div id="ProducerID" data_value=@ViewBag.ProducerID></div>
                            <div id="ProductTID" data_value=@ViewBag.ProductTID></div>
                            <div class="row is-grid-active">
                                @foreach (var item in Model)
                                {
                                    
                                    var r = item.Price * item.Sale;
                                    int b = (int)(item.Price - r);
                                    float Sale = (item.Sale * 100);
                                    <div class="col-lg-4 col-md-6 col-sm-6">
                                        <div class="product-m">
                                            <div class="product-m__thumb">

                                                <a class="aspect aspect--bg-grey aspect--square u-d-block" href=@Url.Action("ProductDetail","Home",new { ID = item.ID })>

                                                    <img class="aspect__img" src='data:image/png;base64,@item.Image' alt="">
                                                </a>
                                                <div class="product-m__quick-look">

                                                    <a class="fas fa-search" data-modal="modal" data-modal-id="#pd-@item.ID" data-tooltip="tooltip" data-placement="top" title="Quick Look"></a>
                                                </div>
                                                @if ((UserLogin)(Session["SS"]) != null)
                                                {
                                                    <div class="product-m__add-cart">

                                                        <a class="btn--e-brand addcartindex" data_value=@item.ID data_value2=@DBIO.get1ColorFirst(item.ID).ID data-modal="modal" data-modal-id="#add-to-cart-@item.ID">Thêm vào giỏ hàng</a>
                                                    </div>}
                                                else
                                                { <div class="product-m__add-cart">
                                                        <a class="btn--e-brand" href="/User/Login">Đăng nhập để mua hàng</a>
                                                    </div>
                                                }
                                            </div>
                                            <div class="product-m__content">
                                                <span class="product-o__category">

                                                    <a href=@Url.Action("Product","Home",new {ProducerID=item.ProducerID})>@DBIO.get1Producer_ProducerID(item.ProducerID).ProducerName</a> @if (Sale != 0)
                                                    {
                                                        string time = ((int)(DBIO.get1SaleProduct(item.ID).SaleTimeEnd - DateTime.Now).TotalDays).ToString() + 'N';
                                                        <i style="color:red;"> Sale @Sale %</i><i style="float:right;font-size:80%"> Còn <i style="color:green"> @time</i> </i>}
                                                </span>
                                                <div class="product-m__name">

                                                    <a href=@Url.Action("ProductDetail","Home",new { ID = item.ID })>@item.ProductName</a>
                                                </div>
                                                <div class="product-m__rating gl-rating-style">
                                                    @{
                                                        var Review = DBIO.AVGRatingReview(item.ID);

                                                    }
                                                    @for (int i = 0; i < (int)Review; i++)
                                                    {
                                                        <i class="fas fa-star"></i>
                                                    }
                                                    @if (Review - (int)Review > 0.25 & Review - (int)Review < 0.75)
                                                    {
                                                        <i class="fas fa-star-half-alt"></i>
                                                    }
                                                    @if (Review - (int)Review >= 0.75)
                                                    {
                                                        <i class="fas fa-star"></i>
                                                    }
                                                    @if (Review - (int)Review <= 0.25)
                                                    {
                                                        for (int i = 0; i < (5 - ((int)Review)); i++)
                                                        {
                                                            <i class="far fa-star"></i>
                                                        }
                                                    }
                                                    else
                                                    {
                                                        for (int i = 0; i < (5 - ((int)Review + 1)); i++)
                                                        {
                                                            <i class="far fa-star"></i>
                                                        }
                                                    }





                                                    <span class="product-m__review">(👁️‍🗨️ @item.View1)</span><span style="float:right;font-size:80%">Đã bán: @DBIO.SumsellPD(item.ID) </span>

                                                </div>
                                                <span class="product-o__price">
                                                    @String.Format("{0:0,0}", @b) đ

                                                    @if (Sale != 0)
                                                    {<span class="product-o__discount">@String.Format("{0:0,0}", @item.Price) đ</span>}
                                                </span>
                                                <div class="product-m__hover">
                                                    <div class="product-m__preview-description">

                                                        <span>@item.Note</span>
                                                    </div>
                                                    @if (Session["SS"]!= null)
                                                    {
                                                    <div class="product-m__wishlist">

                                                        <a class="far fa-heart addWishList" data_value=@item.ID data-tooltip="tooltip" data-placement="top" title="Thêm vào yêu thích"></a>
                                                    </div>}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                }
                            </div>
                            <div class="u-s-p-y-60">

                                <!--====== Pagination ======-->
                                <ul class="shop-p__pagination">
                                    @for (int item = 1; item < ViewBag.page + 1; item++)
                                    {
                                        if (ViewBag.number == item)
                                        {
                                            <li class="is-active">

                                                <a>@item</a>
                                            </li>
                                        }
                                        else
                                        {
                                            <li>

                                                <a class="page" data_value=@item>@item</a>
                                            </li>
                                        }

                                    }
                                    @if (ViewBag.page != 1)
                                    {
                                    <li>
                                    <a class="fas fa-angle-right page" data_value=@(ViewBag.Number + 1)></a>
                                    </li>}
                                </ul>
                                <!--====== End - Pagination ======-->
                            </div>
                        </div>
                        
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!--====== End - Section 1 ======-->
</div>

